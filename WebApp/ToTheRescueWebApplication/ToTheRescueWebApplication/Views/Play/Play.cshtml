@{
    Layout = "~/Views/Shared/_Layout3.cshtml";
    ViewBag.Title = "Play";
}
@model ToTheRescueWebApplication.Models.Play.PlayModel

<audio controls loop id="playMusic" source src="@Url.Action("LoadAudio", new { @mapID = Model.CurrentMap })" autoplay hidden="hidden">
</audio>
<script>
    var vid = document.getElementById("playMusic");
    vid.volume = 0.05;
</script>
<nav id="playMenu">
    <div class="profileInfo">
        <label id="name">Name: @Model.ProfileName</label>
        <label id="level">Grade Level: @Model.GradeLevel</label>
        <label id="subject">Subject: @Model.Subject</label>
    </div>
    <div class="icons">
        <ul class="buttons">
            <li id="play">
                <img src="~/Images/playIcon.png" class="icon" alt="Play">
                <label class="iconLbls " id="playLbl">Play</label>
            </li>
            <li id="sanctuary">
                <a href="../AnimalSanctuary/Sanctuary">
                    <img src="~/Images/sanctuaryIcon.png" class="icon" alt="Sanctuary">
                </a>
                <label class="iconLbls "id="sanctuaryLbl">Sanctuary</label>
            </li>
            <li id="menu">
                <a href="../MainMenu/MainMenu">
                    <img src="~/Images/menuIcon.png" class="icon" alt="Menu">
                </a>
                <label class="iconLbls " id="menuLbl">Menu</label>
            </li>
            <li id="options">
                <a href="../Options/Options">
                    <img src="~/Images/optionsIcon.png" class="icon" alt="Options">
                </a>
                <label class="iconLbls " id="optionsLbl">Options</label>
            </li>
        </ul>
    </div>
</nav>
<div class="mapContainer">
    <img src="@Url.Action("ShowMapImage", new { @mapID = Model.CurrentMap })" id="mapImg" alt="Map">
    <img src="@Url.Action("ShowAnimalImage", new { @AnimalID = Model.Animal })" id="animalImg" alt="Animal" style="margin-top: 35%;left: 70%;">
    <img src="@Url.Action("ShowAvatarImage", new { @profileID = Model.Avatar })" id="avatarImg" alt="Profile Avatar" style="margin-top:@Model.MapNodes[Model.CurrentNode - 1].YCoordinate%; left:@Model.MapNodes[Model.CurrentNode - 1].XCoordinate%">
</div>
@section scripts {
<script>
    //transfer nodes from Model into JS array
    var nodeArr = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.MapNodes));
    //when play button clicked: load/display minigame --> call controller function to update values --> move avatar
    $(document).ready(function () {
        $("#play").click(function () {
            $.ajax({
                url: '/Play/FinishMiniGame/',   //update values after minigame in controller
                success: function () {
                    moveAvatar();               //move avatar
                }
            });
        });
    });
    //Get current node from ProfileProgess table through contoller method and move avatar to current node
    function moveAvatar() {
        $.ajax({
            url: '/Play/GetCurrentNode/',
           datatype: "text",
            type: "POST",
            success: function (data) {
                $("#avatarImg").animate({ 'margin-top': nodeArr[data - 1].YCoordinate + '%' }, 'slow');
                $("#avatarImg").animate({ 'left': nodeArr[data - 1].XCoordinate + '%' }, 'slow');
            }
        });
    };
</script>
}
